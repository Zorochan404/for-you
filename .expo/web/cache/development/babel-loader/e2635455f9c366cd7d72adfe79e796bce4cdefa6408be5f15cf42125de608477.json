{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nvar _jsxFileName = \"/home/zoro/Projects/for-you/screens/ChatScreen.js\";\nimport React, { useState, useEffect, useLayoutEffect, useCallback } from 'react';\nimport TouchableOpacity from \"react-native-web/dist/exports/TouchableOpacity\";\nimport Text from \"react-native-web/dist/exports/Text\";\nimport { collection, addDoc, orderBy, query, onSnapshot } from 'firebase/firestore';\nimport { signOut } from 'firebase/auth';\nimport { auth, database } from '../config/firebase';\nimport { useNavigation } from '@react-navigation/native';\nimport { AntDesign } from '@expo/vector-icons';\nimport colors from '../colors';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function Chat() {\n  var _this = this,\n    _auth$currentUser;\n  var _useState = useState([]),\n    _useState2 = _slicedToArray(_useState, 2),\n    messages = _useState2[0],\n    setMessages = _useState2[1];\n  var navigation = useNavigation();\n  var onSignOut = function onSignOut() {\n    signOut(auth).catch(function (error) {\n      return console.log('Error logging out: ', error);\n    });\n  };\n  useLayoutEffect(function () {\n    navigation.setOptions({\n      headerRight: function headerRight() {\n        return _jsxDEV(TouchableOpacity, {\n          style: {\n            marginRight: 10\n          },\n          onPress: onSignOut,\n          children: _jsxDEV(AntDesign, {\n            name: \"logout\",\n            size: 24,\n            color: colors.gray,\n            style: {\n              marginRight: 10\n            }\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 41,\n            columnNumber: 15\n          }, _this)\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 35,\n          columnNumber: 13\n        }, _this);\n      }\n    });\n  }, [navigation]);\n  useLayoutEffect(function () {\n    var collectionRef = collection(database, 'chats');\n    var q = query(collectionRef, orderBy('createdAt', 'desc'));\n    var unsubscribe = onSnapshot(q, function (querySnapshot) {\n      console.log('querySnapshot unsusbscribe');\n      setMessages(querySnapshot.docs.map(function (doc) {\n        return {\n          _id: doc.data()._id,\n          createdAt: doc.data().createdAt.toDate(),\n          text: doc.data().text,\n          user: doc.data().user\n        };\n      }));\n    });\n    return unsubscribe;\n  }, []);\n  var _onSend = useCallback(function () {\n    var messages = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : [];\n    setMessages(function (previousMessages) {\n      return GiftedChat.append(previousMessages, messages);\n    });\n    var _messages$ = messages[0],\n      _id = _messages$._id,\n      createdAt = _messages$.createdAt,\n      text = _messages$.text,\n      user = _messages$.user;\n    addDoc(collection(database, 'chats'), {\n      _id: _id,\n      createdAt: createdAt,\n      text: text,\n      user: user\n    });\n  }, []);\n  return _jsxDEV(GiftedChat, {\n    messages: messages,\n    showAvatarForEveryMessage: false,\n    showUserAvatar: false,\n    onSend: function onSend(messages) {\n      return _onSend(messages);\n    },\n    messagesContainerStyle: {\n      backgroundColor: '#fff'\n    },\n    textInputStyle: {\n      backgroundColor: '#fff',\n      borderRadius: 20\n    },\n    user: {\n      _id: auth == null ? void 0 : (_auth$currentUser = auth.currentUser) == null ? void 0 : _auth$currentUser.email,\n      avatar: 'https://i.pravatar.cc/300'\n    }\n  }, void 0, false, {\n    fileName: _jsxFileName,\n    lineNumber: 86,\n    columnNumber: 9\n  }, this);\n}","map":{"version":3,"names":["React","useState","useEffect","useLayoutEffect","useCallback","TouchableOpacity","Text","collection","addDoc","orderBy","query","onSnapshot","signOut","auth","database","useNavigation","AntDesign","colors","jsxDEV","_jsxDEV","Chat","_this","_auth$currentUser","_useState","_useState2","_slicedToArray","messages","setMessages","navigation","onSignOut","catch","error","console","log","setOptions","headerRight","style","marginRight","onPress","children","name","size","color","gray","fileName","_jsxFileName","lineNumber","columnNumber","collectionRef","q","unsubscribe","querySnapshot","docs","map","doc","_id","data","createdAt","toDate","text","user","onSend","arguments","length","undefined","previousMessages","GiftedChat","append","_messages$","showAvatarForEveryMessage","showUserAvatar","messagesContainerStyle","backgroundColor","textInputStyle","borderRadius","currentUser","email","avatar"],"sources":["/home/zoro/Projects/for-you/screens/ChatScreen.js"],"sourcesContent":["import React, {\n    useState,\n    useEffect,\n    useLayoutEffect,\n    useCallback\n  } from 'react';\n  import { TouchableOpacity, Text } from 'react-native';\n//   import { GiftedChat } from 'react-native-gifted-chat';\n  import {\n    collection,\n    addDoc,\n    orderBy,\n    query,\n    onSnapshot\n  } from 'firebase/firestore';\n  import { signOut } from 'firebase/auth';\n  import { auth, database } from '../config/firebase';\n  import { useNavigation } from '@react-navigation/native';\n  import { AntDesign } from '@expo/vector-icons';\n  import colors from '../colors';\n\n\n  export default function Chat() {\n\n    const [messages, setMessages] = useState([]);\n    const navigation = useNavigation();\n\n  const onSignOut = () => {\n      signOut(auth).catch(error => console.log('Error logging out: ', error));\n    };\n\n    useLayoutEffect(() => {\n        navigation.setOptions({\n          headerRight: () => (\n            <TouchableOpacity\n              style={{\n                marginRight: 10\n              }}\n              onPress={onSignOut}\n            >\n              <AntDesign name=\"logout\" size={24} color={colors.gray} style={{marginRight: 10}}/>\n            </TouchableOpacity>\n          )\n        });\n      }, [navigation]);\n\n    useLayoutEffect(() => {\n\n        const collectionRef = collection(database, 'chats');\n        const q = query(collectionRef, orderBy('createdAt', 'desc'));\n\n    const unsubscribe = onSnapshot(q, querySnapshot => {\n        console.log('querySnapshot unsusbscribe');\n          setMessages(\n            querySnapshot.docs.map(doc => ({\n              _id: doc.data()._id,\n              createdAt: doc.data().createdAt.toDate(),\n              text: doc.data().text,\n              user: doc.data().user\n            }))\n          );\n        });\n    return unsubscribe;\n      }, []);\n\n    const onSend = useCallback((messages = []) => {\n        setMessages(previousMessages =>\n          GiftedChat.append(previousMessages, messages)\n        );\n        // setMessages([...messages, ...messages]);\n        const { _id, createdAt, text, user } = messages[0];    \n        addDoc(collection(database, 'chats'), {\n          _id,\n          createdAt,\n          text,\n          user\n        });\n      }, []);\n\n      return (\n        // <>\n        //   {messages.map(message => (\n        //     <Text key={message._id}>{message.text}</Text>\n        //   ))}\n        // </>\n        <GiftedChat\n          messages={messages}\n          showAvatarForEveryMessage={false}\n          showUserAvatar={false}\n          onSend={messages => onSend(messages)}\n          messagesContainerStyle={{\n            backgroundColor: '#fff'\n          }}\n          textInputStyle={{\n            backgroundColor: '#fff',\n            borderRadius: 20,\n          }}\n          user={{\n            _id: auth?.currentUser?.email,\n            avatar: 'https://i.pravatar.cc/300'\n          }}\n        />\n      );\n}"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}