{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport _toConsumableArray from \"@babel/runtime/helpers/toConsumableArray\";\nimport React, { useState, useRef } from 'react';\nimport { isBlurhashString, isThumbhashString } from '../utils/resolveSources';\nfunction findBestSourceForSize(sources, size) {\n  var _map$sort$sort$0$sour, _ref, _ref$map$sort$sort$;\n  if ((sources == null ? void 0 : sources.length) === 1) {\n    return sources[0];\n  }\n  return (_map$sort$sort$0$sour = (_ref = _toConsumableArray(sources || [])) == null ? void 0 : (_ref$map$sort$sort$ = _ref.map(function (source) {\n    if (!size) {\n      return {\n        source: source,\n        penalty: 0,\n        covers: false\n      };\n    }\n    var _ref2 = typeof source === 'object' ? source : {\n        width: null,\n        height: null\n      },\n      width = _ref2.width,\n      height = _ref2.height;\n    if (width == null || height == null) {\n      return {\n        source: source,\n        penalty: 0,\n        covers: false\n      };\n    }\n    if (width < size.width || height < size.height) {\n      return {\n        source: source,\n        penalty: Math.max(size.width - width, size.height - height),\n        covers: false\n      };\n    }\n    return {\n      source: source,\n      penalty: (width - size.width) * (height - size.height),\n      covers: true\n    };\n  }).sort(function (a, b) {\n    return a.penalty - b.penalty;\n  }).sort(function (a, b) {\n    return Number(b.covers) - Number(a.covers);\n  })[0]) == null ? void 0 : _ref$map$sort$sort$.source) != null ? _map$sort$sort$0$sour : null;\n}\nfunction getCSSMediaQueryForSource(source) {\n  var _source$webMaxViewpor;\n  return `(max-width: ${(_source$webMaxViewpor = source.webMaxViewportWidth) != null ? _source$webMaxViewpor : source.width}px) ${source.width}px`;\n}\nfunction selectSource(sources, size, responsivePolicy) {\n  var _staticSupportedSourc, _staticSupportedSourc2, _staticSupportedSourc3;\n  if (sources == null || sources.length === 0) {\n    return null;\n  }\n  if (sources.length === 1) {\n    return sources[0];\n  }\n  if (responsivePolicy !== 'static') {\n    return findBestSourceForSize(sources, size);\n  }\n  var staticSupportedSources = sources.filter(function (s) {\n    return s.uri && s.width != null && !isBlurhashString(s.uri) && !isThumbhashString(s.uri);\n  }).sort(function (a, b) {\n    var _ref3, _a$webMaxViewportWidt, _ref4, _b$webMaxViewportWidt;\n    return ((_ref3 = (_a$webMaxViewportWidt = a.webMaxViewportWidth) != null ? _a$webMaxViewportWidt : a.width) != null ? _ref3 : 0) - ((_ref4 = (_b$webMaxViewportWidt = b.webMaxViewportWidth) != null ? _b$webMaxViewportWidt : b.width) != null ? _ref4 : 0);\n  });\n  if (staticSupportedSources.length === 0) {\n    console.warn(\"You've set the `static` responsivePolicy but none of the sources have the `width` properties set. Make sure you set both `width` and `webMaxViewportWidth` for best results when using static responsiveness. Falling back to the `initial` policy.\");\n    return findBestSourceForSize(sources, size);\n  }\n  var srcset = staticSupportedSources == null ? void 0 : staticSupportedSources.map(function (source) {\n    return `${source.uri} ${source.width}w`;\n  }).join(', ');\n  var sizes = `${staticSupportedSources == null ? void 0 : staticSupportedSources.map(getCSSMediaQueryForSource).join(', ')}, ${(_staticSupportedSourc = staticSupportedSources[staticSupportedSources.length - 1]) == null ? void 0 : _staticSupportedSourc.width}px`;\n  return {\n    srcset: srcset,\n    sizes: sizes,\n    uri: (_staticSupportedSourc2 = (_staticSupportedSourc3 = staticSupportedSources[staticSupportedSources.length - 1]) == null ? void 0 : _staticSupportedSourc3.uri) != null ? _staticSupportedSourc2 : '',\n    type: 'srcset'\n  };\n}\nexport default function useSourceSelection(sources) {\n  var _sources$length;\n  var responsivePolicy = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 'static';\n  var measurementCallback = arguments.length > 2 && arguments[2] !== undefined ? arguments[2] : null;\n  var hasMoreThanOneSource = ((_sources$length = sources == null ? void 0 : sources.length) != null ? _sources$length : 0) > 1;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    size = _useState2[0],\n    setSize = _useState2[1];\n  var resizeObserver = useRef(null);\n  React.useEffect(function () {\n    return function () {\n      var _resizeObserver$curre;\n      (_resizeObserver$curre = resizeObserver.current) == null ? void 0 : _resizeObserver$curre.disconnect();\n    };\n  }, []);\n  var containerRef = React.useCallback(function (element) {\n    if (!hasMoreThanOneSource && !measurementCallback) {\n      return;\n    }\n    var rect = element == null ? void 0 : element.getBoundingClientRect();\n    measurementCallback == null ? void 0 : measurementCallback(element, rect);\n    setSize(rect);\n    if (responsivePolicy === 'live') {\n      var _resizeObserver$curre2;\n      (_resizeObserver$curre2 = resizeObserver.current) == null ? void 0 : _resizeObserver$curre2.disconnect();\n      if (!element) {\n        return;\n      }\n      resizeObserver.current = new ResizeObserver(function (entries) {\n        setSize(entries[0].contentRect);\n        measurementCallback == null ? void 0 : measurementCallback(entries[0].target, entries[0].contentRect);\n      });\n      resizeObserver.current.observe(element);\n    }\n  }, [hasMoreThanOneSource, responsivePolicy, measurementCallback]);\n  var source = selectSource(sources, size, responsivePolicy);\n  return React.useMemo(function () {\n    return {\n      containerRef: containerRef,\n      source: source\n    };\n  }, [source]);\n}","map":{"version":3,"names":["React","useState","useRef","isBlurhashString","isThumbhashString","findBestSourceForSize","sources","size","_map$sort$sort$0$sour","_ref","_ref$map$sort$sort$","length","_toConsumableArray","map","source","penalty","covers","_ref2","width","height","Math","max","sort","a","b","Number","getCSSMediaQueryForSource","_source$webMaxViewpor","webMaxViewportWidth","selectSource","responsivePolicy","_staticSupportedSourc","_staticSupportedSourc2","_staticSupportedSourc3","staticSupportedSources","filter","s","uri","_ref3","_a$webMaxViewportWidt","_ref4","_b$webMaxViewportWidt","console","warn","srcset","join","sizes","type","useSourceSelection","_sources$length","arguments","undefined","measurementCallback","hasMoreThanOneSource","_useState","_useState2","_slicedToArray","setSize","resizeObserver","useEffect","_resizeObserver$curre","current","disconnect","containerRef","useCallback","element","rect","getBoundingClientRect","_resizeObserver$curre2","ResizeObserver","entries","contentRect","target","observe","useMemo"],"sources":["/home/zoro/Projects/for-you/node_modules/expo-image/src/web/useSourceSelection.ts"],"sourcesContent":["import React, { useState, useRef } from 'react';\n\nimport { ImageProps, ImageSource } from '../Image.types';\nimport { isBlurhashString, isThumbhashString } from '../utils/resolveSources';\n\nfunction findBestSourceForSize(\n  sources: ImageSource[] | undefined,\n  size: DOMRect | null\n): ImageSource | null {\n  if (sources?.length === 1) {\n    return sources[0];\n  }\n  return (\n    [...(sources || [])]\n      // look for the smallest image that's still larger then a container\n      ?.map((source) => {\n        if (!size) {\n          return { source, penalty: 0, covers: false };\n        }\n        const { width, height } =\n          typeof source === 'object' ? source : { width: null, height: null };\n        if (width == null || height == null) {\n          return { source, penalty: 0, covers: false };\n        }\n        if (width < size.width || height < size.height) {\n          return {\n            source,\n            penalty: Math.max(size.width - width, size.height - height),\n            covers: false,\n          };\n        }\n        return { source, penalty: (width - size.width) * (height - size.height), covers: true };\n      })\n      .sort((a, b) => a.penalty - b.penalty)\n      .sort((a, b) => Number(b.covers) - Number(a.covers))[0]?.source ?? null\n  );\n}\n\nexport interface SrcSetSource extends ImageSource {\n  srcset: string;\n  sizes: string;\n  // used as key and a fallback in case srcset is not supported\n  uri: string;\n  type: 'srcset';\n}\n\nfunction getCSSMediaQueryForSource(source: ImageSource) {\n  return `(max-width: ${source.webMaxViewportWidth ?? source.width}px) ${source.width}px`;\n}\n\nfunction selectSource(\n  sources: ImageSource[] | undefined,\n  size: DOMRect | null,\n  responsivePolicy: ImageProps['responsivePolicy']\n): ImageSource | SrcSetSource | null {\n  if (sources == null || sources.length === 0) {\n    return null;\n  }\n\n  if (sources.length === 1) {\n    return sources[0];\n  }\n\n  if (responsivePolicy !== 'static') {\n    return findBestSourceForSize(sources, size);\n  }\n  const staticSupportedSources = sources\n    .filter(\n      (s) => s.uri && s.width != null && !isBlurhashString(s.uri) && !isThumbhashString(s.uri)\n    )\n    .sort(\n      (a, b) => (a.webMaxViewportWidth ?? a.width ?? 0) - (b.webMaxViewportWidth ?? b.width ?? 0)\n    );\n\n  if (staticSupportedSources.length === 0) {\n    console.warn(\n      \"You've set the `static` responsivePolicy but none of the sources have the `width` properties set. Make sure you set both `width` and `webMaxViewportWidth` for best results when using static responsiveness. Falling back to the `initial` policy.\"\n    );\n    return findBestSourceForSize(sources, size);\n  }\n\n  const srcset = staticSupportedSources\n    ?.map((source) => `${source.uri} ${source.width}w`)\n    .join(', ');\n  const sizes = `${staticSupportedSources\n    ?.map(getCSSMediaQueryForSource)\n    .join(', ')}, ${staticSupportedSources[staticSupportedSources.length - 1]?.width}px`;\n  return {\n    srcset,\n    sizes,\n    uri: staticSupportedSources[staticSupportedSources.length - 1]?.uri ?? '',\n    type: 'srcset',\n  };\n}\n\ntype UseSourceSelectionReturn = {\n  containerRef: (element: HTMLDivElement) => void;\n  source: ImageSource | SrcSetSource | null;\n};\n\nexport default function useSourceSelection(\n  sources?: ImageSource[],\n  responsivePolicy: ImageProps['responsivePolicy'] = 'static',\n  measurementCallback: ((target: HTMLElement, size: DOMRect) => void) | null = null\n): UseSourceSelectionReturn {\n  const hasMoreThanOneSource = (sources?.length ?? 0) > 1;\n  // null - not calculated yet, DOMRect - size available\n  const [size, setSize] = useState<null | DOMRect>(null);\n  const resizeObserver = useRef<ResizeObserver | null>(null);\n\n  React.useEffect(() => {\n    return () => {\n      resizeObserver.current?.disconnect();\n    };\n  }, []);\n\n  const containerRef = React.useCallback(\n    (element: HTMLDivElement) => {\n      if (!hasMoreThanOneSource && !measurementCallback) {\n        return;\n      }\n      const rect = element?.getBoundingClientRect();\n      measurementCallback?.(element, rect);\n      setSize(rect);\n\n      if (responsivePolicy === 'live') {\n        resizeObserver.current?.disconnect();\n        if (!element) {\n          return;\n        }\n        resizeObserver.current = new ResizeObserver((entries) => {\n          setSize(entries[0].contentRect);\n          measurementCallback?.(entries[0].target as any, entries[0].contentRect);\n        });\n        resizeObserver.current.observe(element);\n      }\n    },\n    [hasMoreThanOneSource, responsivePolicy, measurementCallback]\n  );\n\n  const source = selectSource(sources, size, responsivePolicy);\n\n  return React.useMemo(\n    () => ({\n      containerRef,\n      source,\n    }),\n    [source]\n  );\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}