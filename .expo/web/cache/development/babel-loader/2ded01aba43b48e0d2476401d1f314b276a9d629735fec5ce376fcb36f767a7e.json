{"ast":null,"code":"import _defineProperty from \"@babel/runtime/helpers/defineProperty\";\nimport _asyncToGenerator from \"@babel/runtime/helpers/asyncToGenerator\";\nimport _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nimport { useEffect, useMemo, useState } from 'react';\nimport { useBlurhash } from '../utils/blurhash/useBlurhash';\nimport { isThumbhashString } from '../utils/resolveSources';\nimport { thumbHashStringToDataURL } from '../utils/thumbhash/thumbhash';\nexport function useThumbhash(source) {\n  var _source$uri$replace, _source$uri;\n  var isThumbhash = isThumbhashString((source == null ? void 0 : source.uri) || '');\n  var strippedThumbhashString = (_source$uri$replace = source == null ? void 0 : (_source$uri = source.uri) == null ? void 0 : _source$uri.replace(/thumbhash:\\//, '')) != null ? _source$uri$replace : '';\n  var thumbhashSource = useMemo(function () {\n    return isThumbhash ? {\n      uri: thumbHashStringToDataURL(strippedThumbhashString)\n    } : null;\n  }, [strippedThumbhashString, isThumbhash]);\n  return thumbhashSource;\n}\nexport function useImageHashes(source) {\n  var thumbhash = useThumbhash(source);\n  var blurhash = useBlurhash(source);\n  return useMemo(function () {\n    var _ref;\n    return {\n      resolvedSource: (_ref = blurhash != null ? blurhash : thumbhash) != null ? _ref : source,\n      isImageHash: !!blurhash || !!thumbhash\n    };\n  }, [blurhash, thumbhash]);\n}\nexport function useHeaders(source, cachePolicy, onError) {\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    objectURL = _useState2[0],\n    setObjectURL = _useState2[1];\n  useEffect(function () {\n    _asyncToGenerator(function* () {\n      if (!(source != null && source.headers) || !source.uri) {\n        return;\n      }\n      try {\n        var result = yield fetch(source.uri, {\n          headers: source.headers,\n          cache: cachePolicy === 'none' ? 'no-cache' : 'default',\n          redirect: 'follow'\n        });\n        if (!result.ok) {\n          throw new Error(`Failed to fetch image: ${result.status} ${result.statusText}`);\n        }\n        var blob = yield result.blob();\n        setObjectURL(function (prevObjURL) {\n          if (prevObjURL) {\n            URL.revokeObjectURL(prevObjURL);\n          }\n          return URL.createObjectURL(blob);\n        });\n      } catch (error) {\n        onError == null ? void 0 : onError.forEach(function (e) {\n          return e == null ? void 0 : e({\n            source: source\n          });\n        });\n      }\n    })();\n  }, [source]);\n  if (!(source != null && source.headers)) {\n    return source;\n  }\n  if (!objectURL) {\n    return null;\n  }\n  return _objectSpread(_objectSpread({}, source), {}, {\n    uri: objectURL\n  });\n}","map":{"version":3,"names":["useEffect","useMemo","useState","useBlurhash","isThumbhashString","thumbHashStringToDataURL","useThumbhash","source","_source$uri$replace","_source$uri","isThumbhash","uri","strippedThumbhashString","replace","thumbhashSource","useImageHashes","thumbhash","blurhash","_ref","resolvedSource","isImageHash","useHeaders","cachePolicy","onError","_useState","_useState2","_slicedToArray","objectURL","setObjectURL","_asyncToGenerator","headers","result","fetch","cache","redirect","ok","Error","status","statusText","blob","prevObjURL","URL","revokeObjectURL","createObjectURL","error","forEach","e","_objectSpread"],"sources":["/home/zoro/Projects/for-you/node_modules/expo-image/src/web/hooks.ts"],"sourcesContent":["import { useEffect, useMemo, useState } from 'react';\n\nimport { OnErrorEvent } from './ImageWrapper.types';\nimport { ImageNativeProps, ImageSource } from '../Image.types';\nimport { useBlurhash } from '../utils/blurhash/useBlurhash';\nimport { isThumbhashString } from '../utils/resolveSources';\nimport { thumbHashStringToDataURL } from '../utils/thumbhash/thumbhash';\n\nexport function useThumbhash(source: ImageSource | null | undefined) {\n  const isThumbhash = isThumbhashString(source?.uri || '');\n  const strippedThumbhashString = source?.uri?.replace(/thumbhash:\\//, '') ?? '';\n  const thumbhashSource = useMemo(\n    () => (isThumbhash ? { uri: thumbHashStringToDataURL(strippedThumbhashString) } : null),\n    [strippedThumbhashString, isThumbhash]\n  );\n  return thumbhashSource;\n}\n\nexport function useImageHashes(source: ImageSource | null | undefined) {\n  const thumbhash = useThumbhash(source);\n  const blurhash = useBlurhash(source);\n  return useMemo(\n    () => ({\n      resolvedSource: blurhash ?? thumbhash ?? source,\n      isImageHash: !!blurhash || !!thumbhash,\n    }),\n    [blurhash, thumbhash]\n  );\n}\n\nexport function useHeaders(\n  source: ImageSource | null | undefined,\n  cachePolicy: ImageNativeProps['cachePolicy'],\n  onError?: OnErrorEvent[]\n): ImageSource | null | undefined {\n  const [objectURL, setObjectURL] = useState<string | null>(null);\n  useEffect(() => {\n    (async () => {\n      if (!source?.headers || !source.uri) {\n        return;\n      }\n      try {\n        const result = await fetch(source.uri, {\n          headers: source.headers,\n          cache: cachePolicy === 'none' ? 'no-cache' : 'default',\n          redirect: 'follow',\n        });\n        if (!result.ok) {\n          throw new Error(`Failed to fetch image: ${result.status} ${result.statusText}`);\n        }\n        const blob = await result.blob();\n        setObjectURL((prevObjURL) => {\n          if (prevObjURL) {\n            URL.revokeObjectURL(prevObjURL);\n          }\n          return URL.createObjectURL(blob);\n        });\n        // eslint-disable-next-line @typescript-eslint/no-unused-vars\n      } catch (error) {\n        onError?.forEach((e) => e?.({ source }));\n      }\n    })();\n  }, [source]);\n  if (!source?.headers) {\n    return source;\n  }\n  if (!objectURL) {\n    // Avoid fetching a URL without headers if we have headers\n    return null;\n  }\n  return { ...source, uri: objectURL };\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}