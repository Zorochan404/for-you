{"ast":null,"code":"import _slicedToArray from \"@babel/runtime/helpers/slicedToArray\";\nimport { useEffect, useState, useMemo } from 'react';\nimport decode from './decode';\nimport { isBlurhashString } from '../resolveSources';\nvar DEFAULT_SIZE = {\n  width: 32,\n  height: 32\n};\nvar scaleRatio = 10;\nexport function useBlurhash(blurhash) {\n  var punch = arguments.length > 1 && arguments[1] !== undefined ? arguments[1] : 1;\n  punch = punch || 1;\n  var _useState = useState(null),\n    _useState2 = _slicedToArray(_useState, 2),\n    uri = _useState2[0],\n    setUri = _useState2[1];\n  useEffect(function () {\n    var _blurhash$width, _blurhash$height, _blurhash$width2, _blurhash$height2, _blurhash$width3, _blurhash$height3;\n    var isCanceled = false;\n    if (!blurhash || !blurhash.uri || !isBlurhashString(blurhash.uri)) return;\n    var pixels = decode(blurhash.uri, (_blurhash$width = blurhash == null ? void 0 : blurhash.width) != null ? _blurhash$width : DEFAULT_SIZE.width, (_blurhash$height = blurhash == null ? void 0 : blurhash.height) != null ? _blurhash$height : DEFAULT_SIZE.height, punch);\n    var canvas = document.createElement('canvas');\n    var upscaledCanvas = document.createElement('canvas');\n    canvas.width = (_blurhash$width2 = blurhash == null ? void 0 : blurhash.width) != null ? _blurhash$width2 : DEFAULT_SIZE.width;\n    canvas.height = (_blurhash$height2 = blurhash == null ? void 0 : blurhash.height) != null ? _blurhash$height2 : DEFAULT_SIZE.height;\n    upscaledCanvas.width = ((_blurhash$width3 = blurhash == null ? void 0 : blurhash.width) != null ? _blurhash$width3 : DEFAULT_SIZE.width) * scaleRatio;\n    upscaledCanvas.height = ((_blurhash$height3 = blurhash == null ? void 0 : blurhash.height) != null ? _blurhash$height3 : DEFAULT_SIZE.height) * scaleRatio;\n    var context = canvas.getContext('2d');\n    if (!context) {\n      console.warn('Failed to decode blurhash');\n      return;\n    }\n    var imageData = context.createImageData(canvas.width, canvas.height);\n    imageData.data.set(pixels);\n    context.putImageData(imageData, 0, 0);\n    var upscaledContext = upscaledCanvas.getContext('2d');\n    if (!upscaledContext) {\n      console.warn('Failed to decode blurhash');\n      return;\n    }\n    upscaledContext.scale(scaleRatio, scaleRatio);\n    upscaledContext.drawImage(canvas, 0, 0);\n    upscaledCanvas.toBlob(function (blob) {\n      if (!isCanceled) {\n        setUri(function (oldUrl) {\n          if (oldUrl) {\n            URL.revokeObjectURL(oldUrl);\n          }\n          return blob ? URL.createObjectURL(blob) : oldUrl;\n        });\n      }\n    });\n    return function cleanupBlurhash() {\n      isCanceled = true;\n      setUri(function (oldUrl) {\n        if (oldUrl) {\n          URL.revokeObjectURL(oldUrl);\n        }\n        return null;\n      });\n    };\n  }, [blurhash == null ? void 0 : blurhash.uri, blurhash == null ? void 0 : blurhash.height, blurhash == null ? void 0 : blurhash.width, punch]);\n  return useMemo(function () {\n    return uri ? {\n      uri: uri\n    } : null;\n  }, [uri]);\n}","map":{"version":3,"names":["useEffect","useState","useMemo","decode","isBlurhashString","DEFAULT_SIZE","width","height","scaleRatio","useBlurhash","blurhash","punch","arguments","length","undefined","_useState","_useState2","_slicedToArray","uri","setUri","_blurhash$width","_blurhash$height","_blurhash$width2","_blurhash$height2","_blurhash$width3","_blurhash$height3","isCanceled","pixels","canvas","document","createElement","upscaledCanvas","context","getContext","console","warn","imageData","createImageData","data","set","putImageData","upscaledContext","scale","drawImage","toBlob","blob","oldUrl","URL","revokeObjectURL","createObjectURL","cleanupBlurhash"],"sources":["/home/zoro/Projects/for-you/node_modules/expo-image/src/utils/blurhash/useBlurhash.tsx"],"sourcesContent":["// adapted from https://gist.github.com/ngbrown/d62eb518753378eb0a9bf02bb4723235\n// modified from https://gist.github.com/WorldMaker/a3cbe0059acd827edee568198376b95a\n// https://github.com/woltapp/react-blurhash/issues/3\n\nimport { useEffect, useState, useMemo } from 'react';\n\nimport decode from './decode';\nimport { isBlurhashString } from '../resolveSources';\n\nconst DEFAULT_SIZE = {\n  width: 32,\n  height: 32,\n};\n\n// We scale up the canvas to avoid an irritating visual glitch when animating in Chrome.\nconst scaleRatio = 10;\n\nexport function useBlurhash(\n  blurhash: { uri?: string; width?: number; height?: number } | undefined | null,\n  punch: number = 1\n) {\n  punch = punch || 1;\n\n  const [uri, setUri] = useState<string | null>(null);\n\n  useEffect(() => {\n    let isCanceled = false;\n\n    if (!blurhash || !blurhash.uri || !isBlurhashString(blurhash.uri)) return;\n\n    const pixels = decode(\n      blurhash.uri,\n      blurhash?.width ?? DEFAULT_SIZE.width,\n      blurhash?.height ?? DEFAULT_SIZE.height,\n      punch\n    );\n\n    const canvas = document.createElement('canvas');\n    const upscaledCanvas = document.createElement('canvas');\n    canvas.width = blurhash?.width ?? DEFAULT_SIZE.width;\n    canvas.height = blurhash?.height ?? DEFAULT_SIZE.height;\n    upscaledCanvas.width = (blurhash?.width ?? DEFAULT_SIZE.width) * scaleRatio;\n    upscaledCanvas.height = (blurhash?.height ?? DEFAULT_SIZE.height) * scaleRatio;\n    const context = canvas.getContext('2d');\n    if (!context) {\n      console.warn('Failed to decode blurhash');\n      return;\n    }\n    const imageData = context.createImageData(canvas.width, canvas.height);\n    imageData.data.set(pixels);\n    context.putImageData(imageData, 0, 0);\n    const upscaledContext = upscaledCanvas.getContext('2d');\n    if (!upscaledContext) {\n      console.warn('Failed to decode blurhash');\n      return;\n    }\n    upscaledContext.scale(scaleRatio, scaleRatio);\n    upscaledContext.drawImage(canvas, 0, 0);\n    upscaledCanvas.toBlob((blob) => {\n      if (!isCanceled) {\n        setUri((oldUrl) => {\n          if (oldUrl) {\n            URL.revokeObjectURL(oldUrl);\n          }\n          return blob ? URL.createObjectURL(blob) : oldUrl;\n        });\n      }\n    });\n\n    return function cleanupBlurhash() {\n      isCanceled = true;\n      setUri((oldUrl) => {\n        if (oldUrl) {\n          URL.revokeObjectURL(oldUrl);\n        }\n        return null;\n      });\n    };\n  }, [blurhash?.uri, blurhash?.height, blurhash?.width, punch]);\n  return useMemo(() => (uri ? { uri } : null), [uri]);\n}\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}